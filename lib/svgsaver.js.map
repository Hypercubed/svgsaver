{"version":3,"sources":["../src/svgsaver.js"],"names":[],"mappings":"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","file":"svgsaver.js","sourcesContent":["import saveAs from 'html5-filesaver.js';\nimport {svgAttrs, svgStyles} from './collection';\n\nfunction isUndefined(value) {return typeof value === 'undefined';}\nfunction isDefined(value) {return typeof value !== 'undefined';}\nfunction isFunction(value) {return typeof value === 'function';}\n\n// adapted from https://github.com/angular/angular.js/issues/2866#issuecomment-31012434\nfunction getComputedStyles(node) {\n  if (isDefined(node.currentStyle)) {  //for old IE\n    return node.currentStyle;\n  } else if (isDefined(window.getComputedStyle)){  //for modern browsers\n    return node.ownerDocument.defaultView.getComputedStyle(node,null);\n  } else {\n    return node.style;\n  }\n}\n\n// convert computed styles to something we can iterate over\n// adapted from http://stackoverflow.com/questions/754607/can-jquery-get-all-css-styles-associated-with-an-element/6416527#6416527\nfunction convertComputedStyle(computed) {\n  if(isDefined(window.getComputedStyle)){\n    var styles = {};\n    for(var i = 0, l = computed.length; i < l; i++){\n      var prop = computed[i];\n      var val = computed.getPropertyValue(prop);\n      styles[prop] = val;\n    }\n    return styles;\n  }\n  return computed;\n}\n\nfunction copyStyles(source, target, defaultStyles) {  // styles === false - copy none, true - copy all\n  if (defaultStyles === false) { return; }\n\n  var srcStyles = getComputedStyles(source);\n\n  if (defaultStyles === true) {    // copy all styles\n    for (let key in convertComputedStyle(srcStyles)) {\n      target.style[key] = srcStyles[key];\n    }\n    return;\n  }\n\n  var parStyles = getComputedStyles(target.parentNode);\n\n  for (let key in defaultStyles) {\n    var src = srcStyles[key];\n    if (src && src !== defaultStyles[key] && src !== parStyles[key] ) {\n      target.style[key] = src;\n    }\n  }\n}\n\nfunction cleanAttrs(el, attrs, styles) {  // attrs === false - remove all, attrs === true - allow all\n  if (attrs === true) { return; }\n\n  Array.prototype.slice.call(el.attributes)\n    .forEach(function(attr) {\n      // remove if it is not style nor on attrs  whitelist\n      // keeping attributes that are also styles because attributes override\n      if (attr.specified) {\n        if(attrs === false || (isUndefined(styles[attr.name]) && attrs.indexOf(attr.name) < 0)) {\n          el.removeAttribute(attr.name);\n        }\n      }\n    });\n}\n\nfunction cloneSvg(src, attrs, styles) {\n  var clonedSvg = src.cloneNode(true);\n  var srcChildren = src.querySelectorAll('*');\n\n  Array.prototype.slice.call(clonedSvg.querySelectorAll('*'))\n    .forEach(function( target, index ) {\n      copyStyles(srcChildren[index], target, styles);\n      cleanAttrs(target, attrs, styles);\n    });\n\n  return clonedSvg;\n}\n\n//detection\nvar DownloadAttributeSupport = 'download' in document.createElement('a');\n\nfunction saveUri(url, name){\n  if (DownloadAttributeSupport) {\n    var dl = document.createElement('a');\n    dl.setAttribute('href', url);\n    dl.setAttribute('download', name);\n    dl.click();\n  } else {\n    window.open(url, '_blank', '');\n  }\n  return true;\n}\n\nexport class SvgSaver {\n\n  /**\n  * SvgSaver constructor.\n  * @constructs SvgSaver\n  * @api public\n  *\n  * @example\n  * var svgsaver = new SvgSaver();                      // creates a new instance\n  * var svg = document.querySelector('#mysvg');         // find the SVG element\n  * svgsaver.asSvg(svg);                                // save as SVG\n  */\n  constructor(opts = {}) {\n    // todo: options\n    this.attrs = (opts.attrs === undefined) ? svgAttrs : opts.attrs;\n    this.styles = (opts.styles === undefined) ? svgStyles : opts.styles;\n  }\n\n  /**\n  * Return the SVG HTML text after cleaning\n  *\n  * @param {SVGElement} el The element to copy.\n  * @returns {String} SVG text after cleaning\n  * @api public\n  */\n  getHTML(el) {\n    var svg = cloneSvg(el, this.attrs, this.styles);\n\n    svg.setAttribute('xmlns', 'http://www.w3.org/2000/svg');\n    svg.setAttribute('version', 1.1);\n\n    // height and width needed to download in FireFox\n    svg.setAttribute('width', svg.getAttribute('width') || '500');\n    svg.setAttribute('height', svg.getAttribute('height') || '900');\n\n    return svg.outerHTML || (new window.XMLSerializer()).serializeToString(svg);\n  }\n\n  /**\n  * Return the SVG, after cleaning, as a text/xml Blob\n  *\n  * @param {SVGElement} el The element to copy.\n  * @returns {Blog} SVG as a text/xml Blob\n  * @api public\n  */\n  getBlob(el) {\n    var html = this.getHTML(el);\n    return new Blob([html], { type: 'text/xml' });\n  }\n\n  /**\n  * Return the SVG, after cleaning, as a image/svg+xml;base64 URI encoded string\n  *\n  * @param {SVGElement} el The element to copy.\n  * @returns {String} SVG as image/svg+xml;base64 URI encoded string\n  * @api public\n  */\n  getUri(el) {\n    var html = this.getHTML(el);\n    if (isDefined(window.btoa)) {\n      return 'data:image/svg+xml;base64,' + window.btoa(html);\n    }\n    return 'data:image/svg+xml,' + encodeURIComponent(html);\n  }\n\n  /**\n  * Saves the SVG as a SVG file using method compatible with the browser\n  *\n  * @param {SVGElement} el The element to copy.\n  * @param {string} [filename] The filename to save, defaults to the SVG title or 'untitled.svg'\n  * @returns {SvgSaver} The SvgSaver instance\n  * @api public\n  */\n  asSvg(el, filename) {\n    if (!filename || filename === '') {\n      filename = el.getAttribute('title');\n      filename = (filename || 'untitled')+'.svg';\n    }\n\n    if (isDefined(window.saveAs) && isFunction(Blob)) {\n      saveAs(this.getBlob(el), filename);\n    } else {\n      saveUri(this.getUri(el), filename);\n    }\n    return this;\n\n  }\n\n  /**\n  * Saves the SVG as a PNG file using method compatible with the browser\n  *\n  * @param {SVGElement} el The element to copy.\n  * @param {string} [filename] The filename to save, defaults to the SVG title or 'untitled.png'\n  * @returns {SvgSaver} The SvgSaver instance\n  * @api public\n  */\n  asPng(el, filename) {\n    if (!filename || filename === '') {\n      filename = el.getAttribute('title');\n      filename = (filename || 'untitled')+'.png';\n    }\n\n    var canvas = document.createElement('canvas');\n    var context = canvas.getContext('2d');\n\n    var image = new Image();\n    image.onload = function() {\n      canvas.width = image.width;\n      canvas.height = image.height;\n      context.drawImage(image, 0, 0);\n\n      if (isDefined(window.saveAs) && isDefined(canvas.toBlob)) {\n        canvas.toBlob(function(blob) {\n          saveAs(blob, filename);\n        });\n      } else {\n        var uri = canvas.toDataURL('image/png');\n        saveUri(uri, filename);\n      }\n\n    };\n    image.src = this.getUri(el);\n    return true;\n  }\n\n}\n\nexport default SvgSaver;\n"]}