{"version":3,"sources":["../src/svgsaver.js"],"names":[],"mappings":"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","file":"svgsaver.js","sourcesContent":["import saveAs from 'html5-filesaver.js';\r\nimport {svgAttrs, svgStyles} from './collection';\r\n\r\nfunction isUndefined(value) {return typeof value === 'undefined';}\r\nfunction isDefined(value) {return typeof value !== 'undefined';}\r\nvar forEach = Array.prototype.forEach;\r\n\r\n// adapted from https://github.com/angular/angular.js/issues/2866#issuecomment-31012434\r\nfunction getStyles(node, name) {\r\n  var val;\r\n\r\n  if (isDefined(node.currentStyle)) {  //for old IE\r\n    val = node.currentStyle[name];\r\n  } else if (isDefined(window.getComputedStyle)){  //for modern browsers\r\n    val = node.ownerDocument.defaultView.getComputedStyle(node,null)[name];\r\n  } else {\r\n    val = node.style[name];\r\n  }\r\n  return  (val === '') ? undefined : val;\r\n}\r\n\r\nfunction copyStyles(source, target) {\r\n  for (var key in svgStyles) {\r\n    var _default = svgStyles[key];\r\n    var src = getStyles(source,key);\r\n    //var tgt = getStyles(target,key);\r\n    var par = getStyles(target.parentNode,key);\r\n    if (src && src !== _default /* &&  src !== tgt */ && src !== par  ) {\r\n      target.style[key] = src;\r\n    }\r\n  }\r\n}\r\n\r\nfunction cleanAttrs(el) {\r\n  forEach.call(el.attributes, function(attr) {\r\n    // remove if it is not style nor on whitelist\r\n    // keeping attributes that are also styles because some styles are not copied\r\n    if(attr.specified && isUndefined(svgStyles[attr.name]) && svgAttrs.indexOf(attr.name) < 0) {\r\n      el.removeAttribute(attr.name);\r\n    }\r\n  });\r\n}\r\n\r\nfunction cloneSvg(src) {\r\n  var clonedSvg = src.cloneNode(true);\r\n  var srcChildren = src.querySelectorAll('*');\r\n\r\n  forEach.call(clonedSvg.querySelectorAll('*'), function( target, index ){\r\n    copyStyles(srcChildren[index], target);\r\n    cleanAttrs(target);\r\n  });\r\n\r\n  return clonedSvg;\r\n}\r\n\r\n//detection\r\nvar DownloadAttributeSupport = 'download' in document.createElement('a');\r\n\r\nfunction saveUri(url, name){\r\n  if (DownloadAttributeSupport) {\r\n    var dl = document.createElement('a');\r\n    dl.setAttribute('href', url);\r\n    dl.setAttribute('download', name);\r\n    dl.click();\r\n  } else {\r\n    window.open(url, '_blank', '');\r\n  }\r\n}\r\n\r\nexport class SvgSaver {\r\n  constructor(opts) {\r\n    // todo: options\r\n  }\r\n\r\n  getHTML(el) {\r\n    var svg = cloneSvg(el);\r\n\r\n    svg.setAttribute('xmlns', 'http://www.w3.org/2000/svg');\r\n    svg.setAttribute('version', 1.1);\r\n\r\n    // height and width needed to download in FireFox\r\n    svg.setAttribute('width', svg.getAttribute('width') || '500');\r\n    svg.setAttribute('height', svg.getAttribute('height') || '900');\r\n\r\n    return svg.outerHTML || (new window.XMLSerializer()).serializeToString(svg);\r\n  }\r\n\r\n  getBlob(el) {\r\n    var html = this.getHTML(el);\r\n    return new Blob([html], { type: 'text/xml' });\r\n  }\r\n\r\n  getUri(el) {\r\n    var html = this.getHTML(el);\r\n    return 'data:image/svg+xml;base64,' + window.btoa(html);\r\n    //return \"data:image/svg+xml,\" + encodeURIComponent(html);\r\n  }\r\n\r\n  asSvg(el, filename) {\r\n    if (!filename || filename === '') {\r\n      filename = el.getAttribute('title');\r\n      filename = (filename || 'untitled')+'.svg';\r\n    }\r\n\r\n    if (isDefined(window.saveAs)) {\r\n      return saveAs(this.getBlob(el), filename);\r\n    } else {\r\n      return saveUri(this.getUri(el), filename);\r\n    }\r\n\r\n  }\r\n\r\n  asPng(el, filename) {\r\n    if (!filename || filename === '') {\r\n      filename = el.getAttribute('title');\r\n      filename = (filename || 'untitled')+'.png';\r\n    }\r\n\r\n    var canvas = document.createElement('canvas');\r\n    var context = canvas.getContext('2d');\r\n\r\n    var image = new Image();\r\n    image.onload = function() {\r\n      canvas.width = image.width;\r\n      canvas.height = image.height;\r\n      context.drawImage(image, 0, 0);\r\n\r\n      if (isDefined(window.saveAs) && isDefined(canvas.toBlob)) {\r\n        canvas.toBlob(function(blob) {\r\n          saveAs(blob, filename);\r\n        });\r\n      } else {\r\n        var uri = canvas.toDataURL('image/png');\r\n        saveUri(uri, filename);\r\n      }\r\n\r\n    };\r\n    image.src = this.getUri(el);\r\n  }\r\n\r\n}\r\n\r\nexport default SvgSaver;\r\n"]}