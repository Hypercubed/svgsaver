{"version":3,"sources":["../src/svgsaver.js"],"names":[],"mappings":"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","file":"svgsaver.js","sourcesContent":["import saveAs from 'html5-filesaver.js';\nimport {svgAttrs, svgStyles} from './collection';\n\nfunction isUndefined(value) {return typeof value === 'undefined';}\nfunction isDefined(value) {return typeof value !== 'undefined';}\nfunction isFunction(value) {return typeof value === 'function';}\nvar forEach = Array.prototype.forEach;\n\n// adapted from https://github.com/angular/angular.js/issues/2866#issuecomment-31012434\nfunction getStyles(node, name) {\n  var val;\n\n  if (isDefined(node.currentStyle)) {  //for old IE\n    val = node.currentStyle[name];\n  } else if (isDefined(window.getComputedStyle)){  //for modern browsers\n    val = node.ownerDocument.defaultView.getComputedStyle(node,null)[name];\n  } else {\n    val = node.style[name];\n  }\n  return  (val === '') ? undefined : val;\n}\n\nfunction copyStyles(source, target) {\n  for (var key in svgStyles) {\n    var _default = svgStyles[key];\n    var src = getStyles(source,key);\n    //var tgt = getStyles(target,key);\n    var par = getStyles(target.parentNode,key);\n    if (src && src !== _default /* &&  src !== tgt */ && src !== par  ) {\n      target.style[key] = src;\n    }\n  }\n}\n\nfunction cleanAttrs(el) {\n  forEach.call(el.attributes, function(attr) {\n    // remove if it is not style nor on whitelist\n    // keeping attributes that are also styles because some styles are not copied\n    if(attr.specified && isUndefined(svgStyles[attr.name]) && svgAttrs.indexOf(attr.name) < 0) {\n      el.removeAttribute(attr.name);\n    }\n  });\n}\n\nfunction cloneSvg(src) {\n  var clonedSvg = src.cloneNode(true);\n  var srcChildren = src.querySelectorAll('*');\n\n  forEach.call(clonedSvg.querySelectorAll('*'), function( target, index ){\n    copyStyles(srcChildren[index], target);\n    cleanAttrs(target);\n  });\n\n  return clonedSvg;\n}\n\n//detection\nvar DownloadAttributeSupport = 'download' in document.createElement('a');\n\nfunction saveUri(url, name){\n  if (DownloadAttributeSupport) {\n    var dl = document.createElement('a');\n    dl.setAttribute('href', url);\n    dl.setAttribute('download', name);\n    dl.click();\n  } else {\n    window.open(url, '_blank', '');\n  }\n  return true;\n}\n\nexport class SvgSaver {\n\n  /**\n  * SvgSaver constructor.\n  * @constructs SvgSaver\n  * @api public\n  *\n  * @example\n  * var svgsaver = new SvgSaver();                      // creates a new instance\n  * var svg = document.querySelector('#mysvg');         // find the SVG element\n  * svgsaver.asSvg(svg);                                // save as SVG\n  */\n  constructor(opts) {\n    // todo: options\n  }\n\n  /**\n  * Return the SVG HTML text after cleaning\n  *\n  * @param {SVGElement} el The element to copy.\n  * @returns {String} SVG text after cleaning\n  * @api public\n  */\n  getHTML(el) {\n    var svg = cloneSvg(el);\n\n    svg.setAttribute('xmlns', 'http://www.w3.org/2000/svg');\n    svg.setAttribute('version', 1.1);\n\n    // height and width needed to download in FireFox\n    svg.setAttribute('width', svg.getAttribute('width') || '500');\n    svg.setAttribute('height', svg.getAttribute('height') || '900');\n\n    return svg.outerHTML || (new window.XMLSerializer()).serializeToString(svg);\n  }\n\n  /**\n  * Return the SVG, after cleaning, as a text/xml Blob\n  *\n  * @param {SVGElement} el The element to copy.\n  * @returns {Blog} SVG as a text/xml Blob\n  * @api public\n  */\n  getBlob(el) {\n    var html = this.getHTML(el);\n    return new Blob([html], { type: 'text/xml' });\n  }\n\n  /**\n  * Return the SVG, after cleaning, as a image/svg+xml;base64 URI encoded string\n  *\n  * @param {SVGElement} el The element to copy.\n  * @returns {String} SVG as image/svg+xml;base64 URI encoded string\n  * @api public\n  */\n  getUri(el) {\n    var html = this.getHTML(el);\n    if (isDefined(window.btoa)) {\n      return 'data:image/svg+xml;base64,' + window.btoa(html);\n    }\n    return \"data:image/svg+xml,\" + encodeURIComponent(html);\n  }\n\n  /**\n  * Saves the SVG as a SVG file using method compatible with the browser\n  *\n  * @param {SVGElement} el The element to copy.\n  * @param {string} [filename] The filename to save, defaults to the SVG title or 'untitled.svg'\n  * @returns {SvgSaver} The SvgSaver instance\n  * @api public\n  */\n  asSvg(el, filename) {\n    if (!filename || filename === '') {\n      filename = el.getAttribute('title');\n      filename = (filename || 'untitled')+'.svg';\n    }\n\n    if (isDefined(window.saveAs) && isFunction(Blob)) {\n      saveAs(this.getBlob(el), filename);\n    } else {\n      saveUri(this.getUri(el), filename);\n    }\n    return this;\n\n  }\n\n  /**\n  * Saves the SVG as a PNG file using method compatible with the browser\n  *\n  * @param {SVGElement} el The element to copy.\n  * @param {string} [filename] The filename to save, defaults to the SVG title or 'untitled.png'\n  * @returns {SvgSaver} The SvgSaver instance\n  * @api public\n  */\n  asPng(el, filename) {\n    if (!filename || filename === '') {\n      filename = el.getAttribute('title');\n      filename = (filename || 'untitled')+'.png';\n    }\n\n    var canvas = document.createElement('canvas');\n    var context = canvas.getContext('2d');\n\n    var image = new Image();\n    image.onload = function() {\n      canvas.width = image.width;\n      canvas.height = image.height;\n      context.drawImage(image, 0, 0);\n\n      if (isDefined(window.saveAs) && isDefined(canvas.toBlob)) {\n        canvas.toBlob(function(blob) {\n          saveAs(blob, filename);\n        });\n      } else {\n        var uri = canvas.toDataURL('image/png');\n        saveUri(uri, filename);\n      }\n\n    };\n    image.src = this.getUri(el);\n    return true;\n  }\n\n}\n\nexport default SvgSaver;\n"]}